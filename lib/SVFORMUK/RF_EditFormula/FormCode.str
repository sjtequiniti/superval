∇ Container←Form_Make;⎕wself;ControlName;childlist;list;Fieldlist;Fieldcontrol;FrameWidth;Caption;buttonsize;buttonwhere;where;size;alignment;Header;PickList;NameList;value;sortorder;SortList;MaxRow;MaxCol;Parent;level;node;no;nn;NN;x;fnsize;framelist;relTests[1] [2] Fieldlist←Fieldcontrol←list←0 0⍴""[3] "fmSV" ⎕wi "pointer" 13[4] buttonsize←25 65 ⋄ buttonwhere←¯5[5] FormName ⎕wi "caption" ((FormName ⎕wi "caption")," - Edit a Roll Forward Formula")[6] "fmSV" ⎕wi "∆caption" (("fmSV" ⎕wi "∆caption"),⊂("fmSV" ⎕wi "caption"))[7] :if 300<fnsize←1↑⍴⎕cr "Form_Make"[8]     "Generating Form" Win∆ProgressBar "Open"[9]     ("Menu Items:" "Form Controls:") Win∆ProgressBar "SetLabels"[10]     (1 1 "Help About") Win∆ProgressBar "FileUpdate"[11] :endif[12] [13] Container←"∆Dialog"[14] [15] ⎕wself←"fmEditFormula" ⎕wi "New" "Form" "Hide"[16] ⎕wi "caption" ("fmSV" ⎕wi "caption")[17] ⎕wi "scale" 5[18] ⎕wi "font" ("fmSV" ⎕wi "font")[19] ⎕wi "border" 2 32 64[20] ⎕wi "where" (Win∆CentrePos .60 .80×768 1024×1⌈CharSize÷13 6)[21] ⎕wi "limitwhere" (0.8×¯2↑⎕wi "where")[22] ⎕wi "tooltipwidth" 200[23] ⎕wi "onResize" "AutoResize"[24] ⎕wi "onClose" "ExitSystem ''"[25] ControlName←"fmEditFormula"[26] relTests←0[27] 0 Menu_Make "fmSV"[28] 0 Menu_Make "fmEditFormula"[29] "fmEditFormula" Win∆CutCopyPaste "Build"[30] list←list OVER "fmEditFormula.bnRF_EditFormulaHelp"[31] ⎕wself←"fmEditFormula.bnRF_EditFormulaHelp" ⎕wi "New" "Button"[32] ⎕wi "deferexit" 1[33] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[34] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][35] ⎕wi "∆where" ((x,2)⍴where)[36] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize ⎕wi "∆where")[37] ⎕wi "tooltip" "SuperVal Help"[38] ⎕wi "onClick" ("fmSV.mRF_EditFormulaHelp.mContext"⎕wi "onClick")[39] ⎕wi "caption" "Help"[40] :if buttonimage[41]     ⎕wi "imagelist" "fmSV.iStandard"[42]     ⎕wi "imageindex" 12[43] :endif[44] ⎕wi "visible" ¯1[45] ⎕wi "onMouseDown" "∆HelpField←'#' ⎕wi 'focus' "[46] list←list OVER "fmEditFormula.bnRF_EditFormulaQuit"[47] ⎕wself←"fmEditFormula.bnRF_EditFormulaQuit" ⎕wi "New" "Button"[48] ⎕wi "style" 2[49] ⎕wi "deferexit" 1[50] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[51] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][52] ⎕wi "∆where" ((x,2)⍴where)[53] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize ⎕wi "∆where")[54] ⎕wi "tooltip" "Cancel and Return"[55] ⎕wi "onClick" ("fmSV.mRF_EditFormulaFile.mQuit"⎕wi "onClick")[56] ⎕wi "caption" "Cancel"[57] ⎕wi "order" .5[58] ⎕wi "visible" ¯1[59] list←list OVER "fmEditFormula.bnRF_EditFormulaSave"[60] ⎕wself←"fmEditFormula.bnRF_EditFormulaSave" ⎕wi "New" "Button"[61] ⎕wi "style" 1[62] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[63] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][64] ⎕wi "∆where" ((x,2)⍴where)[65] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize ⎕wi "∆where")[66] ⎕wi "tooltip" "Save Parameters"[67] ⎕wi "onClick" ("fmSV.mRF_EditFormulaFile.mSave"⎕wi "onClick")[68] ⎕wi "caption" "OK"[69] ⎕wi "order" .5[70] ⎕wi "visible" ¯1[71] [72] ⎕wself←"fmEditFormula.lsfield" ⎕wi "New" "List"[73] Fieldlist←Fieldlist OVER "fmEditFormula.lsfield"[74] Fieldcontrol←Fieldcontrol OVER "List"[75] ⎕wi "∆name" "field"[76] ⎕wi "∆type" "Char"[77] ⎕wi "∆mandatory" 1[78] ⎕wi "tooltip" "Select the Data Field to be used"[79] ⎕wi "style" 16 0[80] PickList←GetField[81] ⎕wi "∆update" "GetField"[82] PickList←⊃m2n 1 0↓PickList[83] ⎕wi "list" PickList[84] size←0 0×Win∆TextSize "??? of ??? Selected"[85] size←size⌈(2↑0.5 )×"fmEditFormula" ⎕wi "size"[86] size←1 0 1 0\(size⌈0,20+¯1↑Win∆TextSize PickList) CDIV "fmEditFormula" ⎕wi "size"[87] size←0.5×⍴x←Win∆Calcwhere 0.12 0 0.1 0,size[88] x←(size,2)⍴x[89] ⎕wi "∆where" x[90] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize x)[91] ⎕wi "onClick" "0 0⍴(⊂⎕wi 'name') RF_EditFormula 'Change' "[92] ⎕wi "onExit" "⎕wres←0 List∆CHECK 'fmEditFormula.lsfield'"[93] ⎕wi "onExitError" "Win∆ExitError ⎕warg"[94] [95] ⎕wself←"fmEditFormula.llfield" ⎕wi "New" "Label"[96] ⎕wi "scale" 5[97] ⎕wi "style" 2[98] ⎕wi "extent" (↑⎕wi "Draw" ("?text" "Data Fields"))[99] ⎕wi "caption" "Data Fields"[100] where←4↑,"fmEditFormula.lsfield" ⎕wi "∆where"[101] x←0.5×⍴where←Win∆Calcwhere where-0,(5+1↑⎕wi "extent"),0 0[102] ⎕wi "∆where" ((x,2)⍴where)[103] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize ⎕wi "∆where")[104] [105] ⎕wself←"fmEditFormula.lsescalation" ⎕wi "New" "List"[106] Fieldlist←Fieldlist OVER "fmEditFormula.lsescalation"[107] Fieldcontrol←Fieldcontrol OVER "List"[108] ⎕wi "∆name" "escalation"[109] ⎕wi "∆type" "Char"[110] ⎕wi "∆mandatory" 1[111] ⎕wi "tooltip" "Select the Escalation Rate to be used"[112] ⎕wi "style" 16 0[113] PickList←GetEscalation[114] ⎕wi "∆update" "GetEscalation"[115] PickList←⊃m2n 1 0↓PickList[116] ⎕wi "list" PickList[117] size←0 0×Win∆TextSize "??? of ??? Selected"[118] size←size⌈(2↑0.5 )×"fmEditFormula" ⎕wi "size"[119] size←1 0 1 0\(size⌈0,20+¯1↑Win∆TextSize PickList) CDIV "fmEditFormula" ⎕wi "size"[120] size←0.5×⍴x←Win∆Calcwhere 0.12 0 0.45 0,size[121] x←(size,2)⍴x[122] ⎕wi "∆where" x[123] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize x)[124] ⎕wi "onClick" "0 0⍴(⊂⎕wi 'name') RF_EditFormula 'Change' "[125] ⎕wi "onExit" "⎕wres←0 List∆CHECK 'fmEditFormula.lsescalation'"[126] ⎕wi "onExitError" "Win∆ExitError ⎕warg"[127] [128] ⎕wself←"fmEditFormula.llescalation" ⎕wi "New" "Label"[129] ⎕wi "scale" 5[130] ⎕wi "style" 2[131] ⎕wi "extent" (↑⎕wi "Draw" ("?text" "Escalation Rates"))[132] ⎕wi "caption" "Escalation Rates"[133] where←4↑,"fmEditFormula.lsescalation" ⎕wi "∆where"[134] x←0.5×⍴where←Win∆Calcwhere where-0,(5+1↑⎕wi "extent"),0 0[135] ⎕wi "∆where" ((x,2)⍴where)[136] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize ⎕wi "∆where")[137] [138] ⎕wself←"fmEditFormula.lsothers" ⎕wi "New" "List"[139] Fieldlist←Fieldlist OVER "fmEditFormula.lsothers"[140] Fieldcontrol←Fieldcontrol OVER "List"[141] ⎕wi "∆name" "others"[142] ⎕wi "∆type" "Char"[143] ⎕wi "∆mandatory" 1[144] ⎕wi "tooltip" "Select a Variable to be used"[145] ⎕wi "style" 16 0[146] PickList←GetOthers[147] ⎕wi "∆update" "GetOthers"[148] PickList←⊃m2n 1 0↓PickList[149] ⎕wi "list" PickList[150] size←0 0×Win∆TextSize "??? of ??? Selected"[151] size←size⌈(2↑0.5 )×"fmEditFormula" ⎕wi "size"[152] size←1 0 1 0\(size⌈0,20+¯1↑Win∆TextSize PickList) CDIV "fmEditFormula" ⎕wi "size"[153] size←0.5×⍴x←Win∆Calcwhere 0.12 0 0.8 0,size[154] x←(size,2)⍴x[155] ⎕wi "∆where" x[156] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize x)[157] ⎕wi "onClick" "0 0⍴(⊂⎕wi 'name') RF_EditFormula 'Change' "[158] ⎕wi "onExit" "⎕wres←0 List∆CHECK 'fmEditFormula.lsothers'"[159] ⎕wi "onExitError" "Win∆ExitError ⎕warg"[160] [161] ⎕wself←"fmEditFormula.llothers" ⎕wi "New" "Label"[162] ⎕wi "scale" 5[163] ⎕wi "style" 2[164] ⎕wi "extent" (↑⎕wi "Draw" ("?text" "Other Variables"))[165] ⎕wi "caption" "Other Variables"[166] where←4↑,"fmEditFormula.lsothers" ⎕wi "∆where"[167] x←0.5×⍴where←Win∆Calcwhere where-0,(5+1↑⎕wi "extent"),0 0[168] ⎕wi "∆where" ((x,2)⍴where)[169] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize ⎕wi "∆where")[170] [171] ⎕wself←"fmEditFormula.edFormula" ⎕wi "New" "Edit"[172] Fieldlist←Fieldlist OVER "fmEditFormula.edFormula"[173] Fieldcontrol←Fieldcontrol OVER "Edit"[174] ⎕wi "∆name" "Formula"[175] ⎕wi "∆type" "Char"[176] ⎕wi "∆mandatory" 1[177] ⎕wi "tooltip" "Specify the Formula for the Rolled Forward Data Field"[178] ⎕wi "∆where" (2 2⍴0.75 0 0.2 0)[179] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize (2 2⍴0.75 0 0.2 0))[180] ⎕wi "onExit" "⍎(0∊⍴,⎕wres←0 INPUT∆CHECK 'fmEditFormula.edFormula')/'0 0⍴(⊂⎕wi ''name'') RF_EditFormula ''Change'' ' "[181] ⎕wi "onExitError" "Win∆ExitError ⎕warg"[182] ⎕wi "extent" (2+CharSize×1 81)[183] [184] ⎕wself←"fmEditFormula.llFormula" ⎕wi "New" "Label"[185] ⎕wi "scale" 5[186] ⎕wi "style" 2[187] ⎕wi "extent" (↑⎕wi "Draw" ("?text" (("⍺",⎕tcnl) char_replace "Formula for⍺Rolled Forward Data")))[188] ⎕wi "caption" (("⍺",⎕tcnl) char_replace "Formula for⍺Rolled Forward Data")[189] where←4↑,"fmEditFormula.edFormula" ⎕wi "∆where"[190] size←1↑"fmEditFormula.edFormula" ⎕wi "extent"[191] size←¯3⌈0.5×(1↑⎕wi "extent")-size[192] x←0.5×⍴where←Win∆Calcwhere where-0,size,0,10+¯1↑⎕wi "extent"[193] ⎕wi "∆where" ((x,2)⍴where)[194] ⎕wi "where" (("fmEditFormula" ⎕wi "size") Win∆Resize ⎕wi "∆where")[195] [196] "fmEditFormula" ⎕wi "∆multifile" ""[197] "fmEditFormula" ⎕wi "∆singlefile" ""[198] "fmEditFormula" ⎕wi "∆format" ""[199] "fmEditFormula" ⎕wi "∆financial" 0[200] "fmEditFormula" ⎕wi "∆relrules" 0[201] "fmEditFormula" ⎕wi "∆parm" 0[202] "fmEditFormula" ⎕wi "∆decr" 0[203] "fmEditFormula" ⎕wi "∆file" 0[204] "fmEditFormula" ⎕wi "∆codefile" CodeFile[205] "fmEditFormula" ⎕wi "∆inputstype" ""[206] "fmEditFormula" ⎕wi "∆inputsentry" ""[207] "fmEditFormula" ⎕wi "∆savecn" (⍳0)[208] "fmEditFormula" ⎕wi "∆savedesc" ""[209] list←list OVER "fmEditFormula"[210] "fmEditFormula" ⎕wi "∆fieldlist" Fieldlist[211] "fmEditFormula" ⎕wi "∆fieldcontrol" Fieldcontrol[212] childlist←"fmSV" ⎕wi "∆childlist"[213] list←(⊃¯1↑childlist) OVER list[214] childlist[⍴childlist]←⊂list[215] "fmSV" ⎕wi "∆childlist" childlist[216] list←,⎕split list[217] 0 0⍴((∨/¨(⊂".mRF_EditFormula")⍷¨list)/list) MultiWI "enabled" 1[218] :if 300<fnsize[219]     (fnsize fnsize ".") Win∆ProgressBar "MemberUpdate"[220]     Win∆ProgressBar "Hide"[221] :endif[222] "Init" OpenParameters "RF_EditFormula"[223] "fmEditFormula.bnRF_EditFormulaHelp" ⎕wi "visible" 1[224] "fmEditFormula.bnRF_EditFormulaQuit" ⎕wi "visible" 1[225] "fmEditFormula.bnRF_EditFormulaSave" ⎕wi "visible" 1[226] "#" ⎕wi "focus" "fmEditFormula.lsfield"[227] :if ~0∊⍴,Error←Win∆Initialise "RF_EditFormula"[228]     "Quit" EndModule Module[229]     "fmSV" ⎕wi "pointer" 0[230]     0 0⍴"fmEditFormula" ⎕wi "Delete"[231]     :return[232] :endif[233] :if bar_open←commandbar^"Multi"≡""[234]     bar_open←0×"fmEditFormula.mRF_EditFormulaFile.m" Win∆CommandBar "OKHelp"[235] :endif[236] "fmEditFormula" ⎕wi "Paint"[237] "fmSV" ⎕wi "pointer" 11[238] "fmEditFormula" ⎕wi "onWait" "0 0⍴RF_EditFormula 'Wait' ⋄ 'fmEditFormula' ⎕wi 'modified' 0"[239] 0 0⍴"fmEditFormula" ⎕wi "Wait"[240] 0 0⍴"fmEditFormula" ⎕wi "Delete"[241] "fmSV" ⎕wi "pointer" 0 ∇