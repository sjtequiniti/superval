∇ Container←Form_Make;⎕wself;ControlName;childlist;list;Fieldlist;Fieldcontrol;FrameWidth;Caption;buttonsize;buttonwhere;where;size;alignment;Header;PickList;NameList;value;sortorder;SortList;MaxRow;MaxCol;Parent;level;node;no;nn;NN;x;fnsize;framelist;relTests[1] [2] Fieldlist←Fieldcontrol←list←0 0⍴""[3] "fmSV" ⎕wi "pointer" 13[4] buttonsize←25 65 ⋄ buttonwhere←¯5[5] FormName ⎕wi "caption" ((FormName ⎕wi "caption")," - Excel Output of Valuation Results")[6] "fmSV" ⎕wi "∆caption" (("fmSV" ⎕wi "∆caption"),⊂("fmSV" ⎕wi "caption"))[7] :if 300<fnsize←1↑⍴⎕cr "Form_Make"[8]     "Generating Form" Win∆ProgressBar "Open"[9]     ("Menu Items:" "Form Controls:") Win∆ProgressBar "SetLabels"[10]     (1 1 "Help About") Win∆ProgressBar "FileUpdate"[11] :endif[12] [13] Container←"∆Dialog"[14] [15] ⎕wself←"fmExcel_Output" ⎕wi "New" "Form" "Hide"[16] ⎕wi "caption" ("fmSV" ⎕wi "caption")[17] ⎕wi "scale" 5[18] ⎕wi "font" ("fmSV" ⎕wi "font")[19] ⎕wi "border" 2 32 64[20] ⎕wi "where" (Win∆CentrePos 1.2 1.2×768 1024×1⌈CharSize÷13 6)[21] ⎕wi "limitwhere" (0.8×¯2↑⎕wi "where")[22] ⎕wi "tooltipwidth" 200[23] ⎕wi "onResize" "AutoResize"[24] ⎕wi "onClose" "ExitSystem ''"[25] ControlName←"fmExcel_Output"[26] relTests←0[27] 0 Menu_Make "fmSV"[28] 1 Menu_Make "fmExcel_Output"[29] "fmExcel_Output" Win∆CutCopyPaste "Build"[30] "fmExcel_Output" ⎕wi "∆helpid" 2260[31] list←list OVER "fmExcel_Output.bnExcel_OutputHelp"[32] ⎕wself←"fmExcel_Output.bnExcel_OutputHelp" ⎕wi "New" "Button"[33] ⎕wi "deferexit" 1[34] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[35] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][36] ⎕wi "∆where" ((x,2)⍴where)[37] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[38] ⎕wi "tooltip" "SuperVal Help"[39] ⎕wi "onClick" ("fmSV.mExcel_OutputHelp.mContext"⎕wi "onClick")[40] ⎕wi "caption" "Help"[41] :if buttonimage[42]     ⎕wi "imagelist" "fmSV.iStandard"[43]     ⎕wi "imageindex" 12[44] :endif[45] ⎕wi "visible" ¯1[46] ⎕wi "onMouseDown" "∆HelpField←'#' ⎕wi 'focus' "[47] list←list OVER "fmExcel_Output.bnExcel_OutputQuit"[48] ⎕wself←"fmExcel_Output.bnExcel_OutputQuit" ⎕wi "New" "Button"[49] ⎕wi "style" 2[50] ⎕wi "deferexit" 1[51] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[52] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][53] ⎕wi "∆where" ((x,2)⍴where)[54] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[55] ⎕wi "tooltip" "Quit and Return"[56] ⎕wi "onClick" ("fmSV.mExcel_OutputFile.mQuit"⎕wi "onClick")[57] ⎕wi "caption" "Quit"[58] ⎕wi "∆helpid" 5427[59] ⎕wi "order" .5[60] ⎕wi "visible" ¯1[61] ControlName ⎕wi "∆quitbutton" "fmExcel_Output.bnExcel_OutputQuit"[62] list←list OVER "fmExcel_Output.bnExcel_OutputSave"[63] ⎕wself←"fmExcel_Output.bnExcel_OutputSave" ⎕wi "New" "Button"[64] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[65] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][66] ⎕wi "∆where" ((x,2)⍴where)[67] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[68] ⎕wi "tooltip" "Save Parameters"[69] ⎕wi "onClick" ("fmSV.mExcel_OutputFile.mSave"⎕wi "onClick")[70] ⎕wi "caption" "Save"[71] :if buttonimage[72]     ⎕wi "imagelist" "fmSV.iStandard"[73]     ⎕wi "imageindex" 9[74] :endif[75] ⎕wi "∆helpid" 5428[76] ⎕wi "enabled" 0[77] ⎕wi "order" .5[78] ⎕wi "visible" ¯1[79] "fmExcel_Output" ⎕wi "onModified" "('Excel_Output' 'fmExcel_Output.bnExcel_OutputSave') Win∆SaveEnabled (0≠⎕warg[1])"[80] list←list OVER "fmExcel_Output.bnExcel_OutputSaveAs"[81] ⎕wself←"fmExcel_Output.bnExcel_OutputSaveAs" ⎕wi "New" "Button"[82] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[83] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][84] ⎕wi "∆where" ((x,2)⍴where)[85] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[86] ⎕wi "tooltip" "Save Parameters As ..."[87] ⎕wi "onClick" ("fmSV.mExcel_OutputFile.mSaveAs"⎕wi "onClick")[88] ⎕wi "caption" "Save As"[89] ⎕wi "∆helpid" 5429[90] ⎕wi "order" .5[91] ⎕wi "visible" ¯1[92] list←list OVER "fmExcel_Output.bnExcel_OutputRun"[93] ⎕wself←"fmExcel_Output.bnExcel_OutputRun" ⎕wi "New" "Button"[94] ⎕wi "style" 1[95] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[96] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][97] ⎕wi "∆where" ((x,2)⍴where)[98] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[99] ⎕wi "tooltip" "Save Parameters and Run Excel Output of Valuation Results"[100] ⎕wi "onClick" ("fmSV.mExcel_OutputFile.mRun"⎕wi "onClick")[101] ⎕wi "caption" "Run"[102] :if buttonimage[103]     ⎕wi "imagelist" "fmSV.iStandard"[104]     ⎕wi "imageindex" 33[105] :endif[106] ⎕wi "∆helpid" 5430[107] ⎕wi "order" .5[108] ⎕wi "visible" ¯1[109] [110] ⎕wself←"fmExcel_Output.lvruns" ⎕wi "New" "Listview"[111] Fieldlist←Fieldlist OVER "fmExcel_Output.lvruns"[112] Fieldcontrol←Fieldcontrol OVER "Listview"[113] ⎕wi "∆name" "runs"[114] ⎕wi "∆type" "ListviewM"[115] ⎕wi "∆mandatory" 1[116] ⎕wi "∆helpid" 5431[117] ⎕wi "tooltip" "Select the Database Results to create Excel Output for"[118] list←list OVER "fmExcel_Output.lvruns"[119] ⎕wi "scale" 5[120] ⎕wi "viewmode" "report"[121] ⎕wi "style" 1 4 0[122] ⎕wi "∆where" (4 2⍴0 0 0 0 1 ¯45 1 0)[123] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize (4 2⍴0 0 0 0 1 ¯45 1 0))[124] ⎕wi "∆update" "GetRunList ConsIndex"[125] (PickList NameList sortorder SortList)←4↑GetRunList ConsIndex[126] ⎕wi "list" PickList[127] NameList[;1]←NameList[;1],¨⊂4↑" "[128] ⎕wi "columndisplay" NameList[129] ⎕wi "AutoFit" "header" "all"[130] ⎕wi "∆sortorder" sortorder[131] ⎕wi "∆sortlist" SortList[132] ⎕wi "onColClick" "('fmExcel_Output.lvruns' 'Excel_Output') Win∆SortListview ⎕warg"[133] :if 0=⎕nc "listviewDict"[134] listviewDict←MATRIX keysIn ListviewDict[135] :endif[136] :if ~mt sortorder←DLTB ↑((ListviewDict for "Control" "fmExcel_Output.lvruns") for "Parameters" "") at "Sort"[137] ("fmExcel_Output.lvruns" "Excel_Output") Win∆SortListview sortorder[138] :else[139] ("fmExcel_Output.lvruns" "Excel_Output") Win∆SortListview "Valuation Run Time"[140] :endif[141] ⎕wi "onResize" "Win∆SizeListview ⎕wi 'self'"[142] ⎕wi "onDblClick" "(⎕wi 'self') Results∆Click 1"[143] ⎕wi "onClick" "(⎕wi 'self') Results∆Click 1"[144] ⎕wi "onPaint" "0 Sel∆LabelUpdate 'fmExcel_Output.lvruns' "[145] ⎕wi "onSelect" "0 Sel∆LabelUpdate 'fmExcel_Output.lvruns' ⋄ 0 0⍴(⊂⎕wi 'name') Excel_Output 'Change' "[146] ⎕wi "onExit" "⍎(0∊⍴,⎕wres←0 List∆CHECK 'fmExcel_Output.lvruns')/'0 0⍴(⊂⎕wi ''name'') Excel_Output ''Change'' ' "[147] ⎕wi "onExitError" "Win∆ExitError ⎕warg"[148] ⎕wi "∆rightlabel" "fmExcel_Output.lrruns"[149] [150] ⎕wself←"fmExcel_Output.lrruns" ⎕wi "New" "Label"[151] ⎕wi "scale" 5[152] ⎕wi "extent" (CharSize×¯2↑1,19)[153] ⎕wi "style" 32[154] ⎕wi "caption" " "[155] where←4↑,"fmExcel_Output.lvruns" ⎕wi "∆where"[156] x←0.5×⍴where←Win∆Calcwhere where+((5+1↑2↓"fmExcel_Output.lvruns" ⎕wi "where") CDIV 1↑"fmExcel_Output" ⎕wi "size"),0 0 0[157] ⎕wi "∆where" ((x,2)⍴where)[158] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[159] list←list OVER "fmExcel_Output.bnExcel_OutputMonitor"[160] ⎕wself←"fmExcel_Output.bnExcel_OutputMonitor" ⎕wi "New" "Button"[161] ⎕wi "extent" (size←1.4 1×buttonsize×1⌈CharSize÷13 6)[162] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][163] ⎕wi "∆where" ((x,2)⍴where)[164] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[165] ⎕wi "tooltip" "Monitor the timings for creation of Excel Output"[166] ⎕wi "onClick" ("fmSV.mExcel_OutputFile.mMonitor"⎕wi "onClick")[167] ⎕wi "caption" (("⍺",⎕tcnl) char_replace "Monitor⍺Excel Timings")[168] [169] ⎕wself←"fmExcel_Output.lParmDesc" ⎕wi "New" "Label"[170] ⎕wi "scale" 5[171] ⎕wi "extent" (CharSize×¯2↑1,80)[172] ⎕wi "style" 32[173] ⎕wi "caption" " "[174] ⎕wi "∆where" (2 2⍴0.98 0 0.02 0)[175] ⎕wi "where" (("fmExcel_Output" ⎕wi "size") Win∆Resize (2 2⍴0.98 0 0.02 0))[176] [177] "fmExcel_Output" ⎕wi "∆multifile" ""[178] "fmExcel_Output" ⎕wi "∆singlefile" ""[179] "fmExcel_Output" ⎕wi "∆format" ""[180] "fmExcel_Output" ⎕wi "∆financial" 0[181] "fmExcel_Output" ⎕wi "∆relrules" 0[182] "fmExcel_Output" ⎕wi "∆parm" 0[183] "fmExcel_Output" ⎕wi "∆decr" 0[184] "fmExcel_Output" ⎕wi "∆file" 0[185] "fmExcel_Output" ⎕wi "∆codefile" CodeFile[186] "fmExcel_Output" ⎕wi "∆inputstype" "ClientFile"[187] "fmExcel_Output" ⎕wi "∆inputsentry" "Multi"[188] "fmExcel_Output" ⎕wi "∆savecn" (⍳0)[189] "fmExcel_Output" ⎕wi "∆savedesc" ""[190] list←list OVER "fmExcel_Output"[191] "fmExcel_Output" ⎕wi "∆fieldlist" Fieldlist[192] "fmExcel_Output" ⎕wi "∆fieldcontrol" Fieldcontrol[193] childlist←"fmSV" ⎕wi "∆childlist"[194] list←(⊃¯1↑childlist) OVER list[195] childlist[⍴childlist]←⊂list[196] "fmSV" ⎕wi "∆childlist" childlist[197] list←,⎕split list[198] 0 0⍴((∨/¨(⊂".mExcel_Output")⍷¨list)/list) MultiWI "enabled" 1[199] :if 300<fnsize[200]     (fnsize fnsize ".") Win∆ProgressBar "MemberUpdate"[201]     Win∆ProgressBar "Hide"[202] :endif[203] "Init" OpenParameters "Excel_Output"[204] "fmExcel_Output.bnExcel_OutputHelp" ⎕wi "visible" 1[205] "fmExcel_Output.bnExcel_OutputQuit" ⎕wi "visible" 1[206] "fmExcel_Output.bnExcel_OutputSave" ⎕wi "visible" 1[207] "fmExcel_Output.bnExcel_OutputSaveAs" ⎕wi "visible" 1[208] "fmExcel_Output.bnExcel_OutputRun" ⎕wi "visible" 1[209] "#" ⎕wi "focus" "fmExcel_Output.lvruns"[210] :if ~0∊⍴,Error←Win∆Initialise "Excel_Output"[211]     "Quit" EndModule Module[212]     "fmSV" ⎕wi "pointer" 0[213]     0 0⍴"fmExcel_Output" ⎕wi "Delete"[214]     :return[215] :endif[216] :if bar_open←commandbar^"Multi"≡"Multi"[217]     bar_open←0×"fmExcel_Output.mExcel_OutputFile.m" Win∆CommandBar "RunAsHelp"[218] :endif[219] "fmExcel_Output" ⎕wi "Paint"[220] "fmSV" ⎕wi "pointer" 11[221] "fmExcel_Output" ⎕wi "onWait" "0 0⍴Excel_Output 'Wait' ⋄ 'fmExcel_Output' ⎕wi 'modified' 0"[222] 0 0⍴"fmExcel_Output" ⎕wi "Wait"[223] 0 0⍴"fmExcel_Output" ⎕wi "Delete"[224] "fmSV" ⎕wi "pointer" 0 ∇