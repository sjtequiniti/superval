∇ Container←Form_Make;⎕wself;ControlName;childlist;list;Fieldlist;Fieldcontrol;FrameWidth;Caption;buttonsize;buttonwhere;where;size;alignment;Header;PickList;NameList;value;sortorder;SortList;MaxRow;MaxCol;Parent;level;node;no;nn;NN;x;fnsize;framelist;relTests[1] [2] Fieldlist←Fieldcontrol←list←0 0⍴""[3] "fmSV" ⎕wi "pointer" 13[4] buttonsize←25 65 ⋄ buttonwhere←¯5[5] FormName ⎕wi "caption" ((FormName ⎕wi "caption")," - Excel Output of Accurate Scenario Results")[6] "fmSV" ⎕wi "∆caption" (("fmSV" ⎕wi "∆caption"),⊂("fmSV" ⎕wi "caption"))[7] :if 300<fnsize←1↑⍴⎕cr "Form_Make"[8]     "Generating Form" Win∆ProgressBar "Open"[9]     ("Menu Items:" "Form Controls:") Win∆ProgressBar "SetLabels"[10]     (1 1 "Help About") Win∆ProgressBar "FileUpdate"[11] :endif[12] [13] Container←"∆Dialog"[14] [15] ⎕wself←"fmScenario_Output" ⎕wi "New" "Form" "Hide"[16] ⎕wi "caption" ("fmSV" ⎕wi "caption")[17] ⎕wi "scale" 5[18] ⎕wi "font" ("fmSV" ⎕wi "font")[19] ⎕wi "border" 2 32 64[20] ⎕wi "where" (Win∆CentrePos 1.2 1.2 ×768 1024×1⌈CharSize÷13 6)[21] ⎕wi "limitwhere" (0.8×¯2↑⎕wi "where")[22] ⎕wi "tooltipwidth" 200[23] ⎕wi "onResize" "AutoResize"[24] ⎕wi "onClose" "ExitSystem ''"[25] ControlName←"fmScenario_Output"[26] relTests←0[27] 0 Menu_Make "fmSV"[28] 1 Menu_Make "fmScenario_Output"[29] "fmScenario_Output" Win∆CutCopyPaste "Build"[30] "fmScenario_Output" ⎕wi "∆helpid" 2264[31] list←list OVER "fmScenario_Output.bnScenario_OutputHelp"[32] ⎕wself←"fmScenario_Output.bnScenario_OutputHelp" ⎕wi "New" "Button"[33] ⎕wi "deferexit" 1[34] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[35] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][36] ⎕wi "∆where" ((x,2)⍴where)[37] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[38] ⎕wi "tooltip" "SuperVal Help"[39] ⎕wi "onClick" ("fmSV.mScenario_OutputHelp.mContext"⎕wi "onClick")[40] ⎕wi "caption" "Help"[41] :if buttonimage[42]     ⎕wi "imagelist" "fmSV.iStandard"[43]     ⎕wi "imageindex" 12[44] :endif[45] ⎕wi "visible" ¯1[46] ⎕wi "onMouseDown" "∆HelpField←'#' ⎕wi 'focus' "[47] list←list OVER "fmScenario_Output.bnScenario_OutputQuit"[48] ⎕wself←"fmScenario_Output.bnScenario_OutputQuit" ⎕wi "New" "Button"[49] ⎕wi "style" 2[50] ⎕wi "deferexit" 1[51] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[52] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][53] ⎕wi "∆where" ((x,2)⍴where)[54] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[55] ⎕wi "tooltip" "Quit and Return"[56] ⎕wi "onClick" ("fmSV.mScenario_OutputFile.mQuit"⎕wi "onClick")[57] ⎕wi "caption" "Quit"[58] ⎕wi "∆helpid" 5455[59] ⎕wi "order" .5[60] ⎕wi "visible" ¯1[61] ControlName ⎕wi "∆quitbutton" "fmScenario_Output.bnScenario_OutputQuit"[62] list←list OVER "fmScenario_Output.bnScenario_OutputSave"[63] ⎕wself←"fmScenario_Output.bnScenario_OutputSave" ⎕wi "New" "Button"[64] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[65] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][66] ⎕wi "∆where" ((x,2)⍴where)[67] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[68] ⎕wi "tooltip" "Save Parameters"[69] ⎕wi "onClick" ("fmSV.mScenario_OutputFile.mSave"⎕wi "onClick")[70] ⎕wi "caption" "Save"[71] :if buttonimage[72]     ⎕wi "imagelist" "fmSV.iStandard"[73]     ⎕wi "imageindex" 9[74] :endif[75] ⎕wi "∆helpid" 5456[76] ⎕wi "enabled" 0[77] ⎕wi "order" .5[78] ⎕wi "visible" ¯1[79] "fmScenario_Output" ⎕wi "onModified" "('Scenario_Output' 'fmScenario_Output.bnScenario_OutputSave') Win∆SaveEnabled (0≠⎕warg[1])"[80] list←list OVER "fmScenario_Output.bnScenario_OutputSaveAs"[81] ⎕wself←"fmScenario_Output.bnScenario_OutputSaveAs" ⎕wi "New" "Button"[82] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[83] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][84] ⎕wi "∆where" ((x,2)⍴where)[85] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[86] ⎕wi "tooltip" "Save Parameters As ..."[87] ⎕wi "onClick" ("fmSV.mScenario_OutputFile.mSaveAs"⎕wi "onClick")[88] ⎕wi "caption" "Save As"[89] ⎕wi "∆helpid" 5457[90] ⎕wi "order" .5[91] ⎕wi "visible" ¯1[92] list←list OVER "fmScenario_Output.bnScenario_OutputRun"[93] ⎕wself←"fmScenario_Output.bnScenario_OutputRun" ⎕wi "New" "Button"[94] ⎕wi "style" 1[95] ⎕wi "extent" (size←1×buttonsize×1⌈CharSize÷13 6)[96] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][97] ⎕wi "∆where" ((x,2)⍴where)[98] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[99] ⎕wi "tooltip" "Save Parameters and Run Excel Output of Accurate Scenario Results"[100] ⎕wi "onClick" ("fmSV.mScenario_OutputFile.mRun"⎕wi "onClick")[101] ⎕wi "caption" "Run"[102] :if buttonimage[103]     ⎕wi "imagelist" "fmSV.iStandard"[104]     ⎕wi "imageindex" 33[105] :endif[106] ⎕wi "∆helpid" 5458[107] ⎕wi "order" .5[108] ⎕wi "visible" ¯1[109] [110] ⎕wself←"fmScenario_Output.ckPrimaryOnly" ⎕wi "New" "Check"[111] Fieldlist←Fieldlist OVER "fmScenario_Output.ckPrimaryOnly"[112] Fieldcontrol←Fieldcontrol OVER "Check"[113] ⎕wi "∆name" "PrimaryOnly"[114] ⎕wi "∆type" "Check"[115] ⎕wi "∆helpid" 5459[116] ⎕wi "tooltip" "Indicate which Valuation Runs to Display"[117] ⎕wi "style" 0[118] ⎕wi "caption" "Display only Valuation Runs on the Primary Basis"[119] ⎕wi "∆where" (2 2⍴0.1 0 0.55 0)[120] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize (2 2⍴0.1 0 0.55 0))[121] ⎕wi "extent" ((0 5×CharSize)+Win∆TextSize ⎕wi "caption")[122] ⎕wi "onClick" "(0 0⍴(⊂⎕wi 'name') Scenario_Output 'Change' )"[123] [124] ⎕wself←"fmScenario_Output.lvScenarios" ⎕wi "New" "Listview"[125] Fieldlist←Fieldlist OVER "fmScenario_Output.lvScenarios"[126] Fieldcontrol←Fieldcontrol OVER "Listview"[127] ⎕wi "∆name" "Scenarios"[128] ⎕wi "∆type" "Spinner"[129] ⎕wi "∆helpid" 5460[130] ⎕wi "tooltip" "Select the list of Scenarios that you wish to include in the Excel Output"[131] list←list OVER "fmScenario_Output.lvScenarios"[132] ⎕wi "scale" 5[133] ⎕wi "viewmode" "report"[134] ⎕wi "style" 1 4 0[135] ⎕wi "∆where" (4 2⍴0.02 0 0.25 0 0.15 0 0.25 0)[136] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize (4 2⍴0.02 0 0.25 0 0.15 0 0.25 0))[137] ⎕wi "∆update" "GetScenList"[138] (PickList NameList sortorder SortList)←4↑GetScenList[139] ⎕wi "list" PickList[140] NameList[;1]←NameList[;1],¨⊂4↑" "[141] ⎕wi "columndisplay" NameList[142] ⎕wi "AutoFit" "header" "all"[143] ⎕wi "∆sortorder" sortorder[144] ⎕wi "∆sortlist" SortList[145] ⎕wi "onColClick" "('fmScenario_Output.lvScenarios' 'Scenario_Output') Win∆SortListview ⎕warg"[146] :if 0=⎕nc "listviewDict"[147] listviewDict←MATRIX keysIn ListviewDict[148] :endif[149] :if ~mt sortorder←DLTB ↑((ListviewDict for "Control" "fmScenario_Output.lvScenarios") for "Parameters" "") at "Sort"[150] ("fmScenario_Output.lvScenarios" "Scenario_Output") Win∆SortListview sortorder[151] :else[152] ("fmScenario_Output.lvScenarios" "Scenario_Output") Win∆SortListview "Scenarios"[153] :endif[154] ⎕wi "onResize" "Win∆SizeListview ⎕wi 'self'"[155] ⎕wi "∆spinner" "fmScenario_Output.spScenarios"[156] ⎕wi "onPaint" "1 Sel∆LabelUpdate 'fmScenario_Output.lvScenarios' "[157] ⎕wi "onSelect" "1 Sel∆LabelUpdate 'fmScenario_Output.lvScenarios' ⋄ 0 0⍴(⊂⎕wi 'name') Scenario_Output 'Change' "[158] ⎕wi "onExit" "⍎(0∊⍴,⎕wres←0 List∆CHECK 'fmScenario_Output.lvScenarios')/'0 0⍴(⊂⎕wi ''name'') Scenario_Output ''Change'' ' "[159] ⎕wi "onExitError" "Win∆ExitError ⎕warg"[160] ⎕wi "∆rightlabel" "fmScenario_Output.lrScenarios"[161] [162] ⎕wself←"fmScenario_Output.lrScenarios" ⎕wi "New" "Label"[163] ⎕wi "scale" 5[164] ⎕wi "extent" (CharSize×¯2↑1,19)[165] ⎕wi "style" 32[166] ⎕wi "caption" " "[167] where←4↑,"fmScenario_Output.lvScenarios" ⎕wi "∆where"[168] x←0.5×⍴where←Win∆Calcwhere where+((5+1↑2↓"fmScenario_Output.lvScenarios" ⎕wi "where") CDIV 1↑"fmScenario_Output" ⎕wi "size"),0 0 0[169] ⎕wi "∆where" ((x,2)⍴where)[170] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[171] [172] ⎕wself←"fmScenario_Output.llScenarios" ⎕wi "New" "Label"[173] ⎕wi "scale" 5[174] ⎕wi "style" 2[175] ⎕wi "extent" (↑⎕wi "Draw" ("?text" "Selected Scenarios"))[176] ⎕wi "caption" "Selected Scenarios"[177] where←4↑,"fmScenario_Output.lvScenarios" ⎕wi "∆where"[178] x←0.5×⍴where←Win∆Calcwhere where-0,(5+1↑⎕wi "extent"),0 0[179] ⎕wi "∆where" ((x,2)⍴where)[180] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[181] [182] ⎕wself←"fmScenario_Output.spScenarios" ⎕wi "New" "Spinner"[183] ⎕wi "scale" 5[184] ⎕wi "range" 0 1[185] ⎕wi "wrap" 1[186] where←4↑,"fmScenario_Output.lvScenarios" ⎕wi "∆where"[187] x←0.5×⍴where←Win∆Calcwhere where+0 20 0 ¯30[188] ⎕wi "∆where" ((x,2)⍴where)[189] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[190] ⎕wi "extent" 50 25[191] ⎕wi "onSpin" "0 0⍴⎕wres Scenario_Output 'Spin' "[192] ⎕wi "tooltip" "Selections will be processed in the order displayed.
Use Spinners to re-order a single or contiguous set of selections"[193] [194] ⎕wself←"fmScenario_Output.lvruns" ⎕wi "New" "Listview"[195] Fieldlist←Fieldlist OVER "fmScenario_Output.lvruns"[196] Fieldcontrol←Fieldcontrol OVER "Listview"[197] ⎕wi "∆name" "runs"[198] ⎕wi "∆type" "ListviewM"[199] ⎕wi "∆mandatory" 1[200] ⎕wi "∆helpid" 5461[201] ⎕wi "tooltip" "Select the Valuation Results to be included in Scenario Output"[202] list←list OVER "fmScenario_Output.lvruns"[203] ⎕wi "scale" 5[204] ⎕wi "viewmode" "report"[205] ⎕wi "style" 1 4 0[206] ⎕wi "∆where" (4 2⍴0.2 0 0.01 0 0.65 0 0.98 0)[207] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize (4 2⍴0.2 0 0.01 0 0.65 0 0.98 0))[208] ⎕wi "∆update" "GetRunList RunIndex"[209] (PickList NameList sortorder SortList)←4↑GetRunList RunIndex[210] ⎕wi "list" PickList[211] NameList[;1]←NameList[;1],¨⊂4↑" "[212] ⎕wi "columndisplay" NameList[213] ⎕wi "AutoFit" "header" "all"[214] ⎕wi "∆sortorder" sortorder[215] ⎕wi "∆sortlist" SortList[216] ⎕wi "onColClick" "('fmScenario_Output.lvruns' 'Scenario_Output') Win∆SortListview ⎕warg"[217] :if 0=⎕nc "listviewDict"[218] listviewDict←MATRIX keysIn ListviewDict[219] :endif[220] :if ~mt sortorder←DLTB ↑((ListviewDict for "Control" "fmScenario_Output.lvruns") for "Parameters" "") at "Sort"[221] ("fmScenario_Output.lvruns" "Scenario_Output") Win∆SortListview sortorder[222] :else[223] ("fmScenario_Output.lvruns" "Scenario_Output") Win∆SortListview "Valuation Run Time"[224] :endif[225] ⎕wi "onResize" "Win∆SizeListview ⎕wi 'self'"[226] ⎕wi "onDblClick" "(⎕wi 'self') Results∆Click 1"[227] ⎕wi "onClick" "(⎕wi 'self') Results∆Click 1"[228] ⎕wi "onPaint" "0 Sel∆LabelUpdate 'fmScenario_Output.lvruns' "[229] ⎕wi "onSelect" "0 Sel∆LabelUpdate 'fmScenario_Output.lvruns' ⋄ 0 0⍴(⊂⎕wi 'name') Scenario_Output 'Change' "[230] ⎕wi "onExit" "⍎(0∊⍴,⎕wres←0 List∆CHECK 'fmScenario_Output.lvruns')/'0 0⍴(⊂⎕wi ''name'') Scenario_Output ''Change'' ' "[231] ⎕wi "onExitError" "Win∆ExitError ⎕warg"[232] ⎕wi "∆rightlabel" "fmScenario_Output.lrruns"[233] [234] ⎕wself←"fmScenario_Output.lrruns" ⎕wi "New" "Label"[235] ⎕wi "scale" 5[236] ⎕wi "extent" (CharSize×¯2↑1,19)[237] ⎕wi "style" 32[238] ⎕wi "caption" " "[239] where←4↑,"fmScenario_Output.lvruns" ⎕wi "∆where"[240] x←0.5×⍴where←Win∆Calcwhere where+((5+1↑2↓"fmScenario_Output.lvruns" ⎕wi "where") CDIV 1↑"fmScenario_Output" ⎕wi "size"),0 0 0[241] ⎕wi "∆where" ((x,2)⍴where)[242] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[243] [244] ⎕wself←"fmScenario_Output.edScenDBName" ⎕wi "New" "Edit"[245] Fieldlist←Fieldlist OVER "fmScenario_Output.edScenDBName"[246] Fieldcontrol←Fieldcontrol OVER "Edit"[247] ⎕wi "∆name" "ScenDBName"[248] ⎕wi "∆type" "Char"[249] ⎕wi "∆mandatory" 1[250] ⎕wi "∆valid" ('File' 'mdb' 'xls')[251] ⎕wi "∆helpid" 5462[252] ⎕wi "tooltip" "Specify the Scenario Run Output File Name"[253] ⎕wi "∆where" (2 2⍴0.9 0 0.4 0)[254] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize (2 2⍴0.9 0 0.4 0))[255] ⎕wi "onExit" "⍎(0∊⍴,⎕wres←0 INPUT∆CHECK 'fmScenario_Output.edScenDBName')/'0 0⍴(⊂⎕wi ''name'') Scenario_Output ''Change'' ' "[256] ⎕wi "onExitError" "Win∆ExitError ⎕warg"[257] ⎕wi "extent" (2+CharSize×1 41)[258] [259] ⎕wself←"fmScenario_Output.llScenDBName" ⎕wi "New" "Label"[260] ⎕wi "scale" 5[261] ⎕wi "style" 2[262] ⎕wi "extent" (↑⎕wi "Draw" ("?text" "Scenarios Output Filename"))[263] ⎕wi "caption" "Scenarios Output Filename"[264] where←4↑,"fmScenario_Output.edScenDBName" ⎕wi "∆where"[265] x←0.5×⍴where←Win∆Calcwhere where-0 ¯3 0,10+¯1↑⎕wi "extent"[266] ⎕wi "∆where" ((x,2)⍴where)[267] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[268] list←list OVER "fmScenario_Output.bnScenario_OutputMonitor"[269] ⎕wself←"fmScenario_Output.bnScenario_OutputMonitor" ⎕wi "New" "Button"[270] ⎕wi "extent" (size←1.4 1×buttonsize×1⌈CharSize÷13 6)[271] x←0.5×⍴where←Win∆Calcwhere 1,(¯10-size[1]),1,buttonwhere←buttonwhere-5+size[2][272] ⎕wi "∆where" ((x,2)⍴where)[273] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize ⎕wi "∆where")[274] ⎕wi "tooltip" "Monitor the timings for creation of Excel Output"[275] ⎕wi "onClick" ("fmSV.mScenario_OutputFile.mMonitor"⎕wi "onClick")[276] ⎕wi "caption" (("⍺",⎕tcnl) char_replace "Monitor⍺Excel Timings")[277] [278] ⎕wself←"fmScenario_Output.lParmDesc" ⎕wi "New" "Label"[279] ⎕wi "scale" 5[280] ⎕wi "extent" (CharSize×¯2↑1,80)[281] ⎕wi "style" 32[282] ⎕wi "caption" " "[283] ⎕wi "∆where" (2 2⍴0.98 0 0.02 0)[284] ⎕wi "where" (("fmScenario_Output" ⎕wi "size") Win∆Resize (2 2⍴0.98 0 0.02 0))[285] [286] "fmScenario_Output" ⎕wi "∆multifile" ""[287] "fmScenario_Output" ⎕wi "∆singlefile" ""[288] "fmScenario_Output" ⎕wi "∆format" ""[289] "fmScenario_Output" ⎕wi "∆financial" 0[290] "fmScenario_Output" ⎕wi "∆relrules" 0[291] "fmScenario_Output" ⎕wi "∆parm" 0[292] "fmScenario_Output" ⎕wi "∆decr" 0[293] "fmScenario_Output" ⎕wi "∆file" 0[294] "fmScenario_Output" ⎕wi "∆codefile" CodeFile[295] "fmScenario_Output" ⎕wi "∆inputstype" "ClientFile"[296] "fmScenario_Output" ⎕wi "∆inputsentry" "Multi"[297] "fmScenario_Output" ⎕wi "∆savecn" (⍳0)[298] "fmScenario_Output" ⎕wi "∆savedesc" ""[299] list←list OVER "fmScenario_Output"[300] "fmScenario_Output" ⎕wi "∆fieldlist" Fieldlist[301] "fmScenario_Output" ⎕wi "∆fieldcontrol" Fieldcontrol[302] childlist←"fmSV" ⎕wi "∆childlist"[303] list←(⊃¯1↑childlist) OVER list[304] childlist[⍴childlist]←⊂list[305] "fmSV" ⎕wi "∆childlist" childlist[306] list←,⎕split list[307] 0 0⍴((∨/¨(⊂".mScenario_Output")⍷¨list)/list) MultiWI "enabled" 1[308] :if 300<fnsize[309]     (fnsize fnsize ".") Win∆ProgressBar "MemberUpdate"[310]     Win∆ProgressBar "Hide"[311] :endif[312] "Init" OpenParameters "Scenario_Output"[313] "fmScenario_Output.bnScenario_OutputHelp" ⎕wi "visible" 1[314] "fmScenario_Output.bnScenario_OutputQuit" ⎕wi "visible" 1[315] "fmScenario_Output.bnScenario_OutputSave" ⎕wi "visible" 1[316] "fmScenario_Output.bnScenario_OutputSaveAs" ⎕wi "visible" 1[317] "fmScenario_Output.bnScenario_OutputRun" ⎕wi "visible" 1[318] "#" ⎕wi "focus" "fmScenario_Output.ckPrimaryOnly"[319] :if ~0∊⍴,Error←Win∆Initialise "Scenario_Output"[320]     "Quit" EndModule Module[321]     "fmSV" ⎕wi "pointer" 0[322]     0 0⍴"fmScenario_Output" ⎕wi "Delete"[323]     :return[324] :endif[325] :if bar_open←commandbar^"Multi"≡"Multi"[326]     bar_open←0×"fmScenario_Output.mScenario_OutputFile.m" Win∆CommandBar "RunAsHelp"[327] :endif[328] "fmScenario_Output" ⎕wi "Paint"[329] "fmSV" ⎕wi "pointer" 11[330] "fmScenario_Output" ⎕wi "onWait" "0 0⍴Scenario_Output 'Wait' ⋄ 'fmScenario_Output' ⎕wi 'modified' 0"[331] 0 0⍴"fmScenario_Output" ⎕wi "Wait"[332] 0 0⍴"fmScenario_Output" ⎕wi "Delete"[333] "fmSV" ⎕wi "pointer" 0 ∇